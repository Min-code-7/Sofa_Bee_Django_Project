{% extends "base.html" %}

{% block content %}
    <div class="container">
        <h2>Product List</h2>

        <!-- search bar  -->
        <input type="text" id="search-input" class="form-control" placeholder="Please input product name to search..." onkeyup="searchProducts()">

        <!-- initial: allow any user to add products (add authorize for seller sequently)-->
        <a href="{% url 'add_product' %}" class="btn btn-success'">Add Product</a>

        <!-- show search result -->
        <div id="product-list">
            {% for product in products %}
                <div class="card my-2">
                    <div class="card-body">
                        <h5 class="card-title">{{ product.name }}</h5>
                        <p class="card-text">{{ product.description }}</p>
                        <p><strong>price:</strong> ${{ product.price }}</p>
                        <a href="{% url 'product_detail' product.id %}" class="btn btn-primary">view details</a>
                    </div>
                </div>
            {% empty %}
                <p class="text-muted">no products available</p>
            {% endfor %}
        </div>
    </div>

    <!-- jQuery + AJAX -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function searchProducts() {
            var query = $("#search-input").val();  // get search bar input
            $.ajax({
                url: "{% url 'product_search' %}",  // back-end search API
                data: {'q': query},  // send search keyword
                dataType: 'json',
                success: function(data) {
                    $("#product-list").html("");  // deleate old product-list
                    if (data.products.length === 0) {
                        $("#product-list").html("<p class='text-muted'>No matching items were found</p>");
                    } else {
                        $.each(data.products, function(index, product) {
                            $("#product-list").append(`
                                <div class="card my-2">
                                    <div class="card-body">
                                        <h5 class="card-title">${product.name}</h5>
                                        <p class="card-text">${product.description}</p>
                                        <p><strong>price:</strong> $${product.price}</p>
                                        <a href="/products/${product.id}/" class="btn btn-primary">view details</a>
                                    </div>
                                </div>
                            `);
                        });
                    }
                }
            });
        }
    </script>
{% endblock %}
